<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ãƒãƒ£ãƒƒãƒˆ - YAMABIKO</title>
    <link rel="icon" th:href="@{/img/common/favicon.ico}" href="../static/img/common/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/style.css}" href="../static/css/style.css" />
</head>
<body class="chat-page">
    <div class="slack-container">
        <!-- å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div class="slack-sidebar">
            <div class="slack-sidebar-header">
                <div class="slack-workspace-icon">Y</div>
                <div class="slack-workspace-name">YAMABIKO</div>
            </div>
            <div class="slack-sidebar-nav">
                <a href="#" th:href="@{/chat}" class="slack-nav-item active">
                    <span class="slack-nav-icon">ğŸ </span>
                    <span>ãƒ›ãƒ¼ãƒ </span>
                </a>
                <a href="#" th:href="@{/chat/dm}" class="slack-nav-item">
                    <span class="slack-nav-icon">ğŸ’¬</span>
                    <span>DM</span>
                </a>
                <a href="#" th:href="@{/chat/activity}" class="slack-nav-item">
                    <span class="slack-nav-icon">ğŸ””</span>
                    <span>ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</span>
                </a>
                
                <div class="slack-section">
                    <div class="slack-section-header" id="channelSectionHeader" style="cursor: pointer;">â–¼ ãƒãƒ£ãƒ³ãƒãƒ«</div>
                    <ul class="slack-channel-list" id="channelList">
                        <li th:each="channel : ${channels}" class="slack-channel-item">
                            <a th:href="@{/chat/channel/{id}(id=${channel.id})}">
                                <span class="slack-channel-hash">#</span>
                                <span th:text="${channel.channelName}">ãƒãƒ£ãƒ³ãƒãƒ«å</span>
                            </a>
                            <div th:if="${!channel.isPublic && channelMembership[channel.id()] == false}" style="margin-left: auto;">
                                <form method="post" th:action="@{/chat/channel/{id}/join(id=${channel.id})}" style="display: inline;">
                                    <button type="submit" class="slack-message-action-btn" style="font-size: 11px; padding: 2px 6px;">å‚åŠ </button>
                                </form>
                            </div>
                            <div th:if="${channelMembership[channel.id()] == true}" style="margin-left: auto;">
                                <form method="post" th:action="@{/chat/channel/{id}/leave(id=${channel.id})}" style="display: inline;">
                                    <button type="submit" class="slack-message-action-btn" style="font-size: 11px; padding: 2px 6px; background-color: var(--slack-danger);">é€€å‡º</button>
                                </form>
                            </div>
                        </li>
                        <li class="slack-channel-item" style="padding: 4px 8px;">
                            <button type="button" id="addChannelButton" class="slack-add-channel-btn" style="background: none; border: none; color: var(--slack-text-secondary); cursor: pointer; font-size: 14px; padding: 4px 0; width: 100%; text-align: left;">
                                <span style="margin-right: 4px;">+</span>ãƒãƒ£ãƒ³ãƒãƒ«ã‚’è¿½åŠ ã™ã‚‹
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="slack-create-channel" id="createChannelForm" style="display: none;">
                <div class="slack-create-channel-form">
                    <form method="post" th:action="@{/chat/channel/create}" class="channel-create-form">
                        <label class="channel-create-label">ãƒãƒ£ãƒ³ãƒãƒ«å</label>
                        <input type="text" name="channelName" placeholder="ãƒãƒ£ãƒ³ãƒãƒ«å" required />

                        <label class="channel-create-label">èª¬æ˜</label>
                        <textarea name="description" placeholder="èª¬æ˜ï¼ˆä»»æ„ï¼‰" rows="2"></textarea>

                        <div class="channel-create-toggle">
                            <span>å…¬é–‹è¨­å®š</span>
                            <label>
                                <input type="radio" name="isPublic" value="true" checked />
                                å…¬é–‹
                            </label>
                            <label>
                                <input type="radio" name="isPublic" value="false" />
                                éå…¬é–‹
                            </label>
                        </div>

                        <div class="channel-create-invite" th:if="${allUsers != null}">
                            <button type="button" id="toggleInviteButton" class="channel-invite-toggle-btn" style="background: rgba(255, 255, 255, 0.1); border: 1px solid var(--slack-border); border-radius: 4px; padding: 8px; color: var(--slack-text-secondary); cursor: pointer; font-size: 13px; width: 100%; text-align: left;">
                                åˆæœŸãƒ¡ãƒ³ãƒãƒ¼ã‚’æ‹›å¾…
                            </button>
                            <div id="inviteList" style="display: none; margin-top: 8px;">
                                <div class="channel-create-invite-list">
                                    <label th:each="user : ${allUsers}">
                                        <input type="checkbox" name="invitees"
                                               th:value="${user.userId()}" />
                                        <span th:text="${user.userName()}">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <button type="submit" style="flex: 1;">ä½œæˆ</button>
                            <button type="button" id="cancelChannelButton" style="flex: 1; background-color: var(--slack-border); color: var(--slack-text-primary); border: none; border-radius: 4px; padding: 8px 16px; font-size: 14px; cursor: pointer;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="slack-main">
            <!-- ä¸Šéƒ¨ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="slack-top-header">
                <div class="slack-header-left">
                    <div class="slack-header-channel-name">ãƒãƒ£ãƒ³ãƒãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                </div>
            </div>
            
            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
            <div class="slack-messages" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                <div style="text-align: center; color: var(--slack-text-muted);">
                    <h2 style="color: var(--slack-text-primary); margin-bottom: 16px;">ãƒãƒ£ãƒ³ãƒãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                    <p style="margin-bottom: 24px;">å·¦å´ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ãƒãƒ£ãƒ³ãƒãƒ«ã‚’é¸æŠã™ã‚‹ã‹ã€æ–°ã—ã„ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>
                    
                    <div th:if="${pendingRequests != null && !pendingRequests.isEmpty()}" style="margin-top: 32px; padding: 24px; background-color: rgba(255, 255, 255, 0.05); border-radius: 8px; max-width: 600px;">
                        <h3 style="color: var(--slack-text-primary); margin-bottom: 16px;">ãƒãƒ£ãƒ³ãƒãƒ«ç”³è«‹ï¼ˆæ‰¿èªå¾…ã¡ï¼‰</h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li th:each="request : ${pendingRequests}" style="margin-bottom: 16px; padding: 16px; background-color: rgba(255, 255, 255, 0.1); border-radius: 8px;">
                                <div style="font-weight: bold; margin-bottom: 8px; color: var(--slack-text-primary);" th:text="${request.channelName}">ãƒãƒ£ãƒ³ãƒãƒ«å</div>
                                <div style="margin-bottom: 8px; color: var(--slack-text-secondary);" th:text="${request.description}">èª¬æ˜</div>
                                <div style="margin-bottom: 8px; color: var(--slack-text-muted); font-size: 12px;">
                                    ç¨®åˆ¥:
                                    <span th:text="${request.isPublic ? 'å…¬é–‹' : 'éå…¬é–‹'}">å…¬é–‹</span>
                                </div>
                                <div style="font-size: 12px; color: var(--slack-text-muted); margin-bottom: 12px;">
                                    ç”³è«‹è€…: <span th:text="${request.requestedByName}">ç”³è«‹è€…å</span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <form method="post" th:action="@{/chat/request/{id}/approve(id=${request.id})}" style="display: inline;">
                                        <button type="submit" class="slack-send-btn" style="background-color: var(--slack-success);">æ‰¿èª</button>
                                    </form>
                                    <form method="post" th:action="@{/chat/request/{id}/reject(id=${request.id})}" style="display: inline;">
                                        <button type="submit" class="slack-send-btn" style="background-color: var(--slack-danger);">å´ä¸‹</button>
                                    </form>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <div th:if="${pendingInvitations != null && !pendingInvitations.isEmpty()}" style="margin-top: 32px; padding: 24px; background-color: rgba(255, 255, 255, 0.05); border-radius: 8px; max-width: 600px;">
                        <h3 style="color: var(--slack-text-primary); margin-bottom: 16px;">ãƒãƒ£ãƒ³ãƒãƒ«æ‹›å¾…</h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li th:each="invitation : ${pendingInvitations}" style="margin-bottom: 16px; padding: 16px; background-color: rgba(255, 255, 255, 0.1); border-radius: 8px;">
                                <div style="font-weight: bold; margin-bottom: 8px; color: var(--slack-text-primary);" th:text="${invitation.channelName() != null ? invitation.channelName() : 'ãƒãƒ£ãƒ³ãƒãƒ« ' + invitation.channelId()}">ãƒãƒ£ãƒ³ãƒãƒ«å</div>
                                <div style="font-size: 12px; color: var(--slack-text-muted); margin-bottom: 12px;">
                                    æ‹›å¾…è€…: <span th:text="${invitation.inviterName() != null ? invitation.inviterName() : invitation.inviterId()}"></span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <form method="post" th:action="@{/chat/invitation/{id}/respond(id=${invitation.id()})}" style="display: inline;">
                                        <input type="hidden" name="accept" value="true" />
                                        <button type="submit" class="slack-send-btn" style="background-color: var(--slack-success);">å‚åŠ ã™ã‚‹</button>
                                    </form>
                                    <form method="post" th:action="@{/chat/invitation/{id}/respond(id=${invitation.id()})}" style="display: inline;">
                                        <input type="hidden" name="accept" value="false" />
                                        <button type="submit" class="slack-send-btn" style="background-color: var(--slack-danger);">è¾é€€ã™ã‚‹</button>
                                    </form>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ãƒãƒ£ãƒ³ãƒãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æŠ˜ã‚ŠãŸãŸã¿/å±•é–‹
        document.getElementById('channelSectionHeader').addEventListener('click', function() {
            const channelList = document.getElementById('channelList');
            const isHidden = channelList.style.display === 'none';
            channelList.style.display = isHidden ? 'block' : 'none';
            this.textContent = isHidden ? 'â–¼ ãƒãƒ£ãƒ³ãƒãƒ«' : 'â–¶ ãƒãƒ£ãƒ³ãƒãƒ«';
        });
        
        // ãƒãƒ£ãƒ³ãƒãƒ«è¿½åŠ ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        document.getElementById('addChannelButton').addEventListener('click', function() {
            const form = document.getElementById('createChannelForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
            if (form.style.display === 'block') {
                const input = form.querySelector('input[name="channelName"]');
                if (input) {
                    input.focus();
                }
            }
        });
        
        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        document.getElementById('cancelChannelButton').addEventListener('click', function() {
            document.getElementById('createChannelForm').style.display = 'none';
            const form = document.querySelector('.channel-create-form');
            if (form) {
                form.reset();
                // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                const publicRadio = form.querySelector('input[value="true"]');
                if (publicRadio) {
                    publicRadio.checked = true;
                }
            }
            const inviteList = document.getElementById('inviteList');
            if (inviteList) {
                inviteList.style.display = 'none';
            }
        });
        
        // åˆæœŸãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…ã®ãƒˆã‚°ãƒ«
        const toggleInviteButton = document.getElementById('toggleInviteButton');
        if (toggleInviteButton) {
            toggleInviteButton.addEventListener('click', function() {
                const inviteList = document.getElementById('inviteList');
                if (inviteList) {
                    inviteList.style.display = inviteList.style.display === 'none' ? 'block' : 'none';
                }
            });
        }
    </script>
</body>
</html>
