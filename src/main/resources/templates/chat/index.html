<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>チャット - YAMABIKO</title>
    <link rel="icon" th:href="@{/img/common/favicon.ico}" href="../static/img/common/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/style.css}" href="../static/css/style.css" />
</head>
<body class="chat-page">
    <div class="slack-container">
        <!-- 左サイドバー -->
        <div class="slack-sidebar">
            <div class="slack-sidebar-header">
                <div class="slack-workspace-icon">Y</div>
                <div class="slack-workspace-name">YAMABIKO</div>
            </div>
            <div class="slack-sidebar-nav">
                <a href="#" th:href="@{/chat}" class="slack-nav-item active">
                    <span class="slack-nav-icon">🏠</span>
                    <span>ホーム</span>
                </a>
                <a href="#" th:href="@{/chat/dm}" class="slack-nav-item">
                    <span class="slack-nav-icon">💬</span>
                    <span>DM</span>
                </a>
                <a href="#" th:href="@{/chat/activity}" class="slack-nav-item">
                    <span class="slack-nav-icon">🔔</span>
                    <span>アクティビティ</span>
                </a>
                
                <div class="slack-section">
                    <div class="slack-section-header" id="channelSectionHeader" style="cursor: pointer;">▼ チャンネル</div>
                    <ul class="slack-channel-list" id="channelList">
                        <li th:each="channel : ${channels}" class="slack-channel-item">
                            <a th:href="@{/chat/channel/{id}(id=${channel.id})}">
                                <span class="slack-channel-hash">#</span>
                                <span th:text="${channel.channelName}">チャンネル名</span>
                            </a>
                            <div th:if="${!channel.isPublic && channelMembership[channel.id()] == false}" style="margin-left: auto;">
                                <form method="post" th:action="@{/chat/channel/{id}/join(id=${channel.id})}" style="display: inline;">
                                    <button type="submit" class="slack-message-action-btn" style="font-size: 11px; padding: 2px 6px;">参加</button>
                                </form>
                            </div>
                            <div th:if="${channelMembership[channel.id()] == true}" style="margin-left: auto;">
                                <form method="post" th:action="@{/chat/channel/{id}/leave(id=${channel.id})}" style="display: inline;">
                                    <button type="submit" class="slack-message-action-btn" style="font-size: 11px; padding: 2px 6px; background-color: var(--slack-danger);">退出</button>
                                </form>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="slack-create-channel">
                <div class="slack-create-channel-form">
                    <form method="post" th:action="@{/chat/channel/create}" class="channel-create-form">
                        <label class="channel-create-label">チャンネル名</label>
                        <input type="text" name="channelName" placeholder="チャンネル名" required />

                        <label class="channel-create-label">説明</label>
                        <textarea name="description" placeholder="説明（任意）" rows="2"></textarea>

                        <div class="channel-create-toggle">
                            <span>公開設定</span>
                            <label>
                                <input type="radio" name="isPublic" value="true" checked />
                                公開
                            </label>
                            <label>
                                <input type="radio" name="isPublic" value="false" />
                                非公開
                            </label>
                        </div>

                        <div class="channel-create-invite" th:if="${allUsers != null}">
                            <label class="channel-create-label">初期メンバーを招待</label>
                            <div class="channel-create-invite-list">
                                <label th:each="user : ${allUsers}">
                                    <input type="checkbox" name="invitees"
                                           th:value="${user.userId()}" />
                                    <span th:text="${user.userName()}">ユーザー名</span>
                                </label>
                            </div>
                        </div>

                        <button type="submit">チャンネルを作成</button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- メインコンテンツ -->
        <div class="slack-main">
            <!-- 上部ヘッダー -->
            <div class="slack-top-header">
                <div class="slack-header-left">
                    <div class="slack-header-channel-name">チャンネルを選択してください</div>
                </div>
            </div>
            
            <!-- メインコンテンツエリア -->
            <div class="slack-messages" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                <div style="text-align: center; color: var(--slack-text-muted);">
                    <h2 style="color: var(--slack-text-primary); margin-bottom: 16px;">チャンネルを選択してください</h2>
                    <p style="margin-bottom: 24px;">左側のサイドバーからチャンネルを選択するか、新しいチャンネルを作成してください。</p>
                    
                    <div th:if="${pendingRequests != null && !pendingRequests.isEmpty()}" style="margin-top: 32px; padding: 24px; background-color: rgba(255, 255, 255, 0.05); border-radius: 8px; max-width: 600px;">
                        <h3 style="color: var(--slack-text-primary); margin-bottom: 16px;">チャンネル申請（承認待ち）</h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li th:each="request : ${pendingRequests}" style="margin-bottom: 16px; padding: 16px; background-color: rgba(255, 255, 255, 0.1); border-radius: 8px;">
                                <div style="font-weight: bold; margin-bottom: 8px; color: var(--slack-text-primary);" th:text="${request.channelName}">チャンネル名</div>
                                <div style="margin-bottom: 8px; color: var(--slack-text-secondary);" th:text="${request.description}">説明</div>
                                <div style="margin-bottom: 8px; color: var(--slack-text-muted); font-size: 12px;">
                                    種別:
                                    <span th:text="${request.isPublic ? '公開' : '非公開'}">公開</span>
                                </div>
                                <div style="font-size: 12px; color: var(--slack-text-muted); margin-bottom: 12px;">
                                    申請者: <span th:text="${request.requestedByName}">申請者名</span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <form method="post" th:action="@{/chat/request/{id}/approve(id=${request.id})}" style="display: inline;">
                                        <button type="submit" class="slack-send-btn" style="background-color: var(--slack-success);">承認</button>
                                    </form>
                                    <form method="post" th:action="@{/chat/request/{id}/reject(id=${request.id})}" style="display: inline;">
                                        <button type="submit" class="slack-send-btn" style="background-color: var(--slack-danger);">却下</button>
                                    </form>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <div th:if="${pendingInvitations != null && !pendingInvitations.isEmpty()}" style="margin-top: 32px; padding: 24px; background-color: rgba(255, 255, 255, 0.05); border-radius: 8px; max-width: 600px;">
                        <h3 style="color: var(--slack-text-primary); margin-bottom: 16px;">チャンネル招待</h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li th:each="invitation : ${pendingInvitations}" style="margin-bottom: 16px; padding: 16px; background-color: rgba(255, 255, 255, 0.1); border-radius: 8px;">
                                <div style="font-weight: bold; margin-bottom: 8px; color: var(--slack-text-primary);" th:text="${invitation.channelName() != null ? invitation.channelName() : 'チャンネル ' + invitation.channelId()}">チャンネル名</div>
                                <div style="font-size: 12px; color: var(--slack-text-muted); margin-bottom: 12px;">
                                    招待者: <span th:text="${invitation.inviterName() != null ? invitation.inviterName() : invitation.inviterId()}"></span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <form method="post" th:action="@{/chat/invitation/{id}/respond(id=${invitation.id()})}" style="display: inline;">
                                        <input type="hidden" name="accept" value="true" />
                                        <button type="submit" class="slack-send-btn" style="background-color: var(--slack-success);">参加する</button>
                                    </form>
                                    <form method="post" th:action="@{/chat/invitation/{id}/respond(id=${invitation.id()})}" style="display: inline;">
                                        <input type="hidden" name="accept" value="false" />
                                        <button type="submit" class="slack-send-btn" style="background-color: var(--slack-danger);">辞退する</button>
                                    </form>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // チャンネルセクションの折りたたみ/展開
        document.getElementById('channelSectionHeader').addEventListener('click', function() {
            const channelList = document.getElementById('channelList');
            const isHidden = channelList.style.display === 'none';
            channelList.style.display = isHidden ? 'block' : 'none';
            this.textContent = isHidden ? '▼ チャンネル' : '▶ チャンネル';
        });
    </script>
</body>
</html>
